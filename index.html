<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIN Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 10px;
        }

        h1, h3 {
            text-align: center;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        th, td {
            border: 1px dashed black;
            padding: 10px;
            text-align: center;
        }

        .scanned {
            background: green;
            color: white;
        }

        td.clickable {
            cursor: pointer;
        }

        .btn {
            padding: 15px;
            font-size: 16px;
            cursor: pointer;
            border: 1px solid black;
            background: white;
        }

        .btn.active {
            background: black;
            color: white;
        }

        .compound-btns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .row-btns {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            margin-bottom: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .row-btn {
            padding: 10px;
            font-size: 14px;
            cursor: pointer;
            border: 1px solid black;
            background: white;
        }

        .row-btn.active {
            background: black;
            color: white;
        }

        .lane-controls {
            display: grid;
            grid-template-columns: 1fr 1fr 2fr;
            gap: 10px;
            margin-top: 10px;
        }

        .numpad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }

        .numpad button {
            padding: 20px;
            font-size: 20px;
            cursor: pointer;
            border: 1px solid black;
            background: white;
        }

        .letterpad {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            margin-bottom: 15px;
        }

        .letterpad button {
            padding: 15px;
            font-size: 16px;
            cursor: pointer;
            border: 1px solid black;
            background: white;
        }

        .display {
            width: 100%;
            padding: 15px;
            font-size: 24px;
            text-align: center;
            border: 1px dashed black;
            margin-bottom: 10px;
            font-family: monospace;
        }

        .add-btn {
            width: 100%;
            padding: 20px;
            font-size: 18px;
            cursor: pointer;
            border: 1px solid black;
            background: white;
            margin-bottom: 15px;
        }

        .export-btn {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            cursor: pointer;
            border: 1px solid black;
            background: white;
        }

        .section {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px dashed black;
        }

        .hidden {
            display: none;
        }

        #pdf-export {
            padding: 20px;
        }

        #pdf-export table {
            width: 100%;
            border-collapse: collapse;
        }

        #pdf-export th, #pdf-export td {
            border: 1px dashed black;
            padding: 10px;
            text-align: center;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <h1>VIN Tracker</h1>

    <!-- 8-digit IN input -->
    <div class="section">
        <h3>ENTER 8-DIGIT CODE</h3>
        <div class="display" id="codeDisplay">--------</div>
        <div class="numpad" id="codeNumpad">
            <button onclick="addDigit('1')">1</button>
            <button onclick="addDigit('2')">2</button>
            <button onclick="addDigit('3')">3</button>
            <button onclick="addDigit('4')">4</button>
            <button onclick="addDigit('5')">5</button>
            <button onclick="addDigit('6')">6</button>
            <button onclick="addDigit('7')">7</button>
            <button onclick="addDigit('8')">8</button>
            <button onclick="addDigit('9')">9</button>
            <button onclick="clearCode()">CLR</button>
            <button onclick="addDigit('0')">0</button>
            <button onclick="backspace()">DEL</button>
        </div>
        <div class="letterpad" id="codeLetterpad">
            <button onclick="addDigit('A')">A</button>
            <button onclick="addDigit('B')">B</button>
            <button onclick="addDigit('C')">C</button>
            <button onclick="addDigit('D')">D</button>
            <button onclick="addDigit('E')">E</button>
            <button onclick="addDigit('F')">F</button>
            <button onclick="addDigit('G')">G</button>
            <button onclick="addDigit('H')">H</button>
            <button onclick="addDigit('I')">I</button>
            <button onclick="addDigit('J')">J</button>
            <button onclick="addDigit('K')">K</button>
            <button onclick="addDigit('L')">L</button>
            <button onclick="addDigit('M')">M</button>
            <button onclick="addDigit('N')">N</button>
            <button onclick="addDigit('O')">O</button>
            <button onclick="addDigit('P')">P</button>
            <button onclick="addDigit('Q')">Q</button>
            <button onclick="addDigit('R')">R</button>
            <button onclick="addDigit('S')">S</button>
            <button onclick="addDigit('T')">T</button>
            <button onclick="addDigit('U')">U</button>
            <button onclick="addDigit('V')">V</button>
            <button onclick="addDigit('W')">W</button>
            <button onclick="addDigit('X')">X</button>
            <button onclick="addDigit('Y')">Y</button>
            <button onclick="addDigit('Z')">Z</button>
        </div>
    </div>

    <!-- Compound selection -->
    <div class="section">
        <h3>SELECT COMPOUND</h3>
        <div class="compound-btns">
            <button class="btn" onclick="selectCompound('AB')">AB COMPOUND</button>
            <button class="btn" onclick="selectCompound('VAN')">VAN WORLD</button>
            <button class="btn" onclick="selectCompound('WAYNE')">WAYNE'S WORLD</button>
            <button class="btn" onclick="selectCompound('C1')">C1 COMPOUND</button>
        </div>
    </div>

    <!-- Row selection -->
    <div class="section" id="rowSection">
        <h3>SELECT ROW</h3>
        <div class="row-btns" id="rowBtns"></div>
        <div class="lane-controls">
            <button class="btn" onclick="laneUp()">UP</button>
            <button class="btn" onclick="laneDown()">DOWN</button>
            <button class="btn" onclick="clearLocation()">CLEAR LOCATION</button>
        </div>
    </div>

    <!-- Sub-row for C1 (A/B) -->
    <div class="section hidden" id="subRowSection">
        <h3>SELECT FRONT/BACK</h3>
        <div class="compound-btns">
            <button class="row-btn" onclick="selectSubRow('A')">A - FRONT</button>
            <button class="row-btn" onclick="selectSubRow('B')">B - BACK</button>
        </div>
    </div>

    <!-- Spot number input -->
    <div class="section">
        <h3>ENTER SPOT NUMBER</h3>
        <div class="display" id="spotDisplay">---</div>
        <div class="numpad">
            <button onclick="addSpotDigit('1')">1</button>
            <button onclick="addSpotDigit('2')">2</button>
            <button onclick="addSpotDigit('3')">3</button>
            <button onclick="addSpotDigit('4')">4</button>
            <button onclick="addSpotDigit('5')">5</button>
            <button onclick="addSpotDigit('6')">6</button>
            <button onclick="addSpotDigit('7')">7</button>
            <button onclick="addSpotDigit('8')">8</button>
            <button onclick="addSpotDigit('9')">9</button>
            <button onclick="clearSpot()">CLR</button>
            <button onclick="addSpotDigit('0')">0</button>
            <button onclick="backspaceSpot()">DEL</button>
        </div>
    </div>

    <!-- Location preview -->
    <div class="section">
        <h3>LOCATION PREVIEW</h3>
        <div class="display" id="locationPreview">-</div>
    </div>

    <button class="add-btn" onclick="addEntry()">ADD ENTRY</button>

    <hr>

    <table>
        <thead>
            <tr>
                <th>IN</th>
                <th>LOCATION</th>
                <th>OUT</th>
                <th>LOCATION</th>
            </tr>
        </thead>
        <tbody id="tableBody">
        </tbody>
    </table>

    <button class="export-btn" onclick="exportPDF()">Export to PDF</button>

    <script>
        // State
        let code = '';
        let spot = '';
        let selectedCompound = '';
        let selectedRow = '';
        let selectedSubRow = '';

        // Compound configurations
        const compounds = {
            'AB': { rows: [], prefix: 'AB', spotMax: 300 },
            'VAN': { rows: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split(''), prefix: 'AB', spotMax: 120 },
            'WAYNE': { rows: [], prefix: '', spotMax: 120 },
            'C1': { rows: [], prefix: 'C1', spotMax: 120, hasSubRow: true }
        };

        // Generate AB rows (101-134)
        for (let i = 101; i <= 134; i++) {
            compounds['AB'].rows.push(i.toString());
        }

        // Generate Wayne's World rows (101-130)
        for (let i = 101; i <= 130; i++) {
            compounds['WAYNE'].rows.push(i.toString());
        }

        // Generate C1 rows (201-219)
        for (let i = 201; i <= 219; i++) {
            compounds['C1'].rows.push(i.toString());
        }

        // 8-digit code functions
        function addDigit(d) {
            if (code.length < 8) {
                code += d;
                updateCodeDisplay();
            }
        }

        function clearCode() {
            code = '';
            updateCodeDisplay();
        }

        function backspace() {
            code = code.slice(0, -1);
            updateCodeDisplay();
        }

        function updateCodeDisplay() {
            const display = code.padEnd(8, '-');
            document.getElementById('codeDisplay').textContent = display;
        }

        // Spot number functions
        function addSpotDigit(d) {
            if (spot.length < 3) {
                spot += d;
                updateSpotDisplay();
                updateLocationPreview();
            }
        }

        function clearSpot() {
            spot = '';
            updateSpotDisplay();
            updateLocationPreview();
        }

        function backspaceSpot() {
            spot = spot.slice(0, -1);
            updateSpotDisplay();
            updateLocationPreview();
        }

        function updateSpotDisplay() {
            const display = spot.padStart(3, '0').slice(-3);
            document.getElementById('spotDisplay').textContent = spot ? display : '---';
        }

        // Compound selection
        function selectCompound(comp) {
            selectedCompound = comp;
            selectedRow = '';
            selectedSubRow = '';

            // Update button styles
            document.querySelectorAll('.compound-btns .btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(comp === 'VAN' ? 'VAN' : comp === 'WAYNE' ? 'WAYNE' : comp)) {
                    btn.classList.add('active');
                }
            });

            // Show/hide sub-row section for C1
            document.getElementById('subRowSection').classList.toggle('hidden', !compounds[comp].hasSubRow);

            // Generate row buttons
            renderRowButtons(comp);
            updateLocationPreview();
        }

        function renderRowButtons(comp) {
            const container = document.getElementById('rowBtns');
            container.innerHTML = '';
            compounds[comp].rows.forEach(row => {
                const btn = document.createElement('button');
                btn.className = 'row-btn';
                btn.textContent = row;
                btn.onclick = () => selectRow(row);
                container.appendChild(btn);
            });
        }

        function selectRow(row) {
            selectedRow = row;
            document.querySelectorAll('#rowBtns .row-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent === row);
            });
            updateLocationPreview();
        }

        function selectSubRow(subRow) {
            selectedSubRow = subRow;
            document.querySelectorAll('#subRowSection .row-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.startsWith(subRow));
            });
            updateLocationPreview();
        }

        // Lane up/down functions
        function laneUp() {
            if (!selectedCompound || !selectedRow) return;
            const rows = compounds[selectedCompound].rows;
            const currentIndex = rows.indexOf(selectedRow);
            if (currentIndex > 0) {
                selectRow(rows[currentIndex - 1]);
            }
        }

        function laneDown() {
            if (!selectedCompound || !selectedRow) return;
            const rows = compounds[selectedCompound].rows;
            const currentIndex = rows.indexOf(selectedRow);
            if (currentIndex < rows.length - 1) {
                selectRow(rows[currentIndex + 1]);
            }
        }

        function clearLocation() {
            selectedCompound = '';
            selectedRow = '';
            selectedSubRow = '';
            document.querySelectorAll('.compound-btns .btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('#rowBtns .row-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('#subRowSection .row-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('rowBtns').innerHTML = '';
            document.getElementById('subRowSection').classList.add('hidden');
            updateLocationPreview();
        }

        // Location preview
        function updateLocationPreview() {
            let location = '-';
            const spotStr = spot ? spot.padStart(3, '0') : '___';

            if (selectedCompound && selectedRow) {
                if (selectedCompound === 'AB') {
                    location = 'AB.' + selectedRow + '.' + spotStr;
                } else if (selectedCompound === 'VAN') {
                    location = 'AB.' + selectedRow + '.' + spotStr;
                } else if (selectedCompound === 'WAYNE') {
                    location = selectedRow + '.' + spotStr;
                } else if (selectedCompound === 'C1') {
                    if (selectedSubRow) {
                        location = 'C1.' + selectedRow + '.' + selectedSubRow + '.' + spotStr;
                    } else {
                        location = 'C1.' + selectedRow + '.?.' + spotStr;
                    }
                }
            }

            document.getElementById('locationPreview').textContent = location;
        }

        // Add entry to table
        function addEntry() {
            if (code.length !== 8) {
                alert('Please enter 8-digit code');
                return;
            }
            if (!selectedCompound || !selectedRow || !spot) {
                alert('Please select compound, row and spot');
                return;
            }
            if (selectedCompound === 'C1' && !selectedSubRow) {
                alert('Please select front (A) or back (B)');
                return;
            }

            const location = document.getElementById('locationPreview').textContent;
            const tbody = document.getElementById('tableBody');

            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="clickable">${code}</td>
                <td class="clickable">${location}</td>
                <td class="clickable"></td>
                <td class="clickable"></td>
            `;
            tbody.appendChild(row);

            // Add click handlers to new row
            row.querySelectorAll('td.clickable').forEach(cell => {
                cell.addEventListener('click', handleCellClick);
            });

            // Reset inputs
            code = '';
            spot = '';
            updateCodeDisplay();
            updateSpotDisplay();
            updateLocationPreview();
        }

        // Cell click handler
        function handleCellClick() {
            const row = this.parentElement;
            const cells = row.querySelectorAll('td');
            const cellIndex = Array.from(cells).indexOf(this);

            if (cellIndex === 0 || cellIndex === 1) {
                cells[0].classList.toggle('scanned');
                cells[1].classList.toggle('scanned');
            } else if (cellIndex === 2 || cellIndex === 3) {
                cells[2].classList.toggle('scanned');
                cells[3].classList.toggle('scanned');
            }
        }

        // Export to PDF
        function exportPDF() {
            const table = document.querySelector('table');
            const pdfContent = document.createElement('div');
            pdfContent.id = 'pdf-export';

            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            const dateStr = day + '/' + month + '/' + year;

            const title = document.createElement('h2');
            title.textContent = 'PDI ' + dateStr;
            title.style.textAlign = 'center';
            title.style.marginBottom = '20px';
            pdfContent.appendChild(title);

            const tableClone = table.cloneNode(true);
            tableClone.querySelectorAll('.scanned').forEach(cell => {
                cell.classList.remove('scanned');
            });
            pdfContent.appendChild(tableClone);

            document.body.appendChild(pdfContent);

            const opt = {
                margin: 10,
                filename: 'vin-tracker-' + new Date().toISOString().split('T')[0] + '.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
            };

            html2pdf().set(opt).from(pdfContent).save().then(() => {
                document.body.removeChild(pdfContent);
            });
        }
    </script>
</body>
</html>
